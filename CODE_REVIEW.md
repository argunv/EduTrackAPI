# –û–±–∑–æ—Ä –∫–æ–¥–∞ EduTrack API - –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

## –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 2025-12-28

---

## 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1.1. Hardcoded URL –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è
**–§–∞–π–ª:** `src/edutrack/application/password_reset.py:38`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π URL –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
```python
reset_url = f"https://edutrack.local/reset-password?token={token}"
```
**–†–∏—Å–∫:** 
- URL –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í production –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ–≤–µ—Ä–Ω—ã–π –¥–æ–º–µ–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–º–æ–≥—É—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `FRONTEND_URL` –≤ `config/settings.py`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `settings.frontend_url` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è URL
3. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

### 1.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–∞—Ä–æ–ª–µ–π
**–§–∞–π–ª:** `src/edutrack/application/password_reset.py:51`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ —Å–±—Ä–æ—Å–µ
```python
async def reset_password(self, token: str, new_password: str) -> None:
    # –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã, —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
    user.password_hash = hash_password(new_password)
```
**–†–∏—Å–∫:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª–∞–±—ã–µ –ø–∞—Ä–æ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "123")
- –ù–∞—Ä—É—à–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª—è —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏:
   - –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
   - –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞
   - –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞
   - –•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
2. –ü—Ä–∏–º–µ–Ω—è—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è

---

### 1.3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
**–§–∞–π–ª:** `src/edutrack/presentation/api/routes/v1.py`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –¥–ª—è:
- `/api/v1/auth/login` (—Å—Ç—Ä–æ–∫–∞ 68)
- `/api/v1/auth/password-reset/request` (—Å—Ç—Ä–æ–∫–∞ 235)

**–†–∏—Å–∫:**
- –ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –ø–∞—Ä–æ–ª–∏
- DoS –∞—Ç–∞–∫–∏ —á–µ—Ä–µ–∑ –º–∞—Å—Å–æ–≤—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
- –°–ø–∞–º –Ω–∞ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É `slowapi` –∏–ª–∏ `fastapi-limiter`
2. –î–æ–±–∞–≤–∏—Ç—å rate limiting:
   - Login: 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ 15 –º–∏–Ω—É—Ç –Ω–∞ IP
   - Password reset: 3 –ø–æ–ø—ã—Ç–∫–∏ –≤ —á–∞—Å –Ω–∞ email
3. –î–æ–±–∞–≤–∏—Ç—å –∫–∞–ø—á—É –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

### 1.4. –¢–æ–∫–µ–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
**–§–∞–π–ª:** `src/edutrack/infrastructure/repositories/sqlalchemy.py:275`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î –∫–∞–∫ plain text
```python
reset_token = models.PasswordResetToken(user_id=user_id, token=token, expires_at=expires_at)
```
**–†–∏—Å–∫:**
- –ü—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –ë–î –∞—Ç–∞–∫—É—é—â–∏–π –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–∫—Ç–∏–≤–Ω—ã–º —Ç–æ–∫–µ–Ω–∞–º
- –ú–æ–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –ª—é–±—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –•—Ä–∞–Ω–∏—Ç—å —Ö—ç—à —Ç–æ–∫–µ–Ω–∞ –≤ –ë–î (SHA256)
2. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
3. –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å –ë–î

---

## 2. –ü–†–û–ë–õ–ï–ú–´ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò

### 2.1. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π regex –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ mypy
**–§–∞–π–ª:** `pyproject.toml:72`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –∏—Å–∫–ª—é—á–µ–Ω–∏—è
```toml
"*.egg-info/",
```
**–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**
```
error: The exclude *.egg-info/ is an invalid regular expression
```
**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π regex:
```toml
exclude = [
    "venv/",
    ".venv/",
    "build/",
    "dist/",
    ".*\\.egg-info/",  # –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
]
```

---

### 2.2. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤ bandit.yaml
**–§–∞–π–ª:** `bandit.yaml:7`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π YAML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è glob –ø–∞—Ç—Ç–µ—Ä–Ω–∞
```yaml
- *.egg-info  # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```
**–û—à–∏–±–∫–∞:**
```
expected alphabetic or numeric character, but found '.'
```
**–†–µ—à–µ–Ω–∏–µ:**
```yaml
exclude_dirs:
  - tests
  - venv
  - .venv
  - build
  - dist
  - "*.egg-info"  # –ó–∞–∫–ª—é—á–∏—Ç—å –≤ –∫–∞–≤—ã—á–∫–∏
```

---

## 3. –ü–†–û–ë–õ–ï–ú–´ –ê–†–•–ò–¢–ï–ö–¢–£–†–´ –ò –ö–û–î–ê

### 3.1. Singleton publisher —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
**–§–∞–π–ª:** `src/edutrack/application/messages.py:21`  
**–ü—Ä–æ–±–ª–µ–º–∞:** EmailPublisher —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ —Å–µ—Ä–≤–∏—Å–∞
```python
class MessageService:
    def __init__(self, session: AsyncSession):
        self.publisher = EmailPublisher()  # –ù–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑!
```
**–†–∏—Å–∫:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ RabbitMQ –ø—Ä–∏ –∫–∞–∂–¥–æ–º HTTP –∑–∞–ø—Ä–æ—Å–µ
- –£—Ç–µ—á–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
- –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π singleton instance EmailPublisher
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ lifespan event –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –ó–∞–∫—Ä—ã–≤–∞—Ç—å –≤ shutdown handler
4. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ dependency injection

---

### 3.2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π channel/connection –≤ notifier
**–§–∞–π–ª:** `src/edutrack/notifier/main.py:135-150`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
```python
if 'channel' in globals() and channel and not channel.is_closed:
```
**–†–∏—Å–∫:**
- `channel` –∏ `connection` –æ–±—ä—è–≤–ª–µ–Ω—ã –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ (—Å—Ç—Ä–æ–∫–∞ 21-22)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `'channel' in globals()` –≤—Å–µ–≥–¥–∞ True
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–π –∫–æ–¥

**–†–µ—à–µ–Ω–∏–µ:**
–£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:
```python
if channel and not channel.is_closed:
    await channel.close()
if connection and not connection.is_closed:
    await connection.close()
```

---

### 3.3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞
**–§–∞–π–ª:** `src/edutrack/application/students.py:30`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–µ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```python
user = await self.users.create_user(...)  # flush
await self.session.flush()
student = await self.students.create_student(...)  # flush
await self.session.commit()  # —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å commit
```
**–†–∏—Å–∫:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –ø—Ä–æ—Ñ–∏–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- Orphan records –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π commit –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—É–∂–µ —Ç–∞–∫)
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å rollback
3. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SAVEPOINT –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

### 3.4. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è race condition –≤ –∫–µ—à–µ
**–§–∞–π–ª:** `src/edutrack/application/grades.py:24-41`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–µ—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ commit, –Ω–æ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
```python
async def create_grade(...):
    grade = await self.repo.create_grade(...)
    await self.session.commit()
    await invalidate(self._cache_key(student_id))  # –ü–æ—Å–ª–µ commit!
```
**–†–∏—Å–∫:**
- –ú–µ–∂–¥—É commit –∏ invalidate –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏–∑ –ë–î –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ó–∞–ø–∏—Å–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–µ—à
- Cache inconsistency

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à –ø–µ—Ä–µ–¥ commit
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
3. –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞

---

### 3.5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ —Å–ø–∏—Å–∫–∞—Ö
**–§–∞–π–ª:** `src/edutrack/infrastructure/repositories/sqlalchemy.py:201-208`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—Ä–æ—Å—ã –±–µ–∑ LIMIT –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏
```python
async def list_for_student(self, student_id: UUID):
    stmt = (
        select(models.Grade)
        .where(models.Grade.student_id == student_id)
        .order_by(models.Grade.created_at.desc())
    )  # –ù–µ—Ç .limit()!
```
**–†–∏—Å–∫:**
- –£ —Å—Ç—É–¥–µ–Ω—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—ã—Å—è—á–∏ –æ—Ü–µ–Ω–æ–∫
- –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
- DoS —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤–æ –≤—Å–µ list –º–µ—Ç–æ–¥—ã
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cursor-based –∏–ª–∏ offset-based pagination
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100 –∑–∞–ø–∏—Å–µ–π)

---

### 3.6. SQL –∏–Ω—ä–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ order_by (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è)
**–§–∞–π–ª:** –í–µ—Å—å –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π SQLAlchemy ORM  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø—Ä—è–º—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–µ–π —Å—Ç—Ä–æ–∫

**–•–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:** –í–µ—Å—å –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ SQLAlchemy

---

## 4. –ü–†–û–ë–õ–ï–ú–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### 4.1. N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤
**–§–∞–π–ª:** `src/edutrack/application/classmates.py`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å N+1 problem, —Ö–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `selectinload`

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `selectinload`, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ debug —Ä–µ–∂–∏–º–µ
2. –ü—Ä–æ–≤–µ—Å—Ç–∏ load testing —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤
3. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `joinedload` –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–≤—è–∑–µ–π

---

### 4.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ)
**–§–∞–π–ª:** `src/edutrack/infrastructure/db/models.py`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –≤–∏–¥–Ω–æ —è–≤–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
- `User.email` - —É–∂–µ –µ—Å—Ç—å unique –∏–Ω–¥–µ–∫—Å ‚úÖ
- `PasswordResetToken.token` - –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å
- `Grade.student_id` - –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å
- `Grade.lesson_id` - –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å
- `Message.sender_id` - –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å
- `EmailOutbox.status` - –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ pending

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Alembic —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–æ–≤:
```python
op.create_index('idx_password_reset_token', 'password_reset_tokens', ['token'])
op.create_index('idx_grade_student', 'grades', ['student_id'])
op.create_index('idx_email_outbox_status', 'email_outbox', ['status'])
```

---

### 4.3. Redis connection pool –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
**–§–∞–π–ª:** `src/edutrack/infrastructure/cache/redis.py:14`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∞–∫—Å–∏–º—É–º 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞–ª–æ
```python
pool = ConnectionPool.from_url(settings.redis_url, decode_responses=True, max_connections=10)
```
**–†–∏—Å–∫:**
- –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å—á–µ—Ä–ø–∞–Ω –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ —Ç–∞–π–º–∞—É—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 50-100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. –°–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—É–ª–∞

---

## 5. –ü–†–û–ë–õ–ï–ú–´ –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

### 5.1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ logging –≤–º–µ—Å—Ç–æ structlog
**–§–∞–π–ª:** –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `logging.getLogger(__name__)`  
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö –µ—Å—Ç—å `structlog`, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ
- –õ–æ–≥–∏ –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã
- –°–ª–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å structlog
2. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (request_id, user_id)
3. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è ELK/Grafana Loki

---

### 5.2. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–ø—ã—Ç–∫–∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –£—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É—Å–ø–µ—à–Ω—ã–µ –ª–æ–≥–∏–Ω—ã
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å audit log –¥–ª—è:
1. –í—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤
2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –ò–∑–º–µ–Ω–µ–Ω–∏–π –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª–∏, email)

---

### 5.3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫ –¥–ª—è Prometheus/Grafana:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –û—à–∏–±–∫–∏
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å `prometheus-fastapi-instrumentator`
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ `/metrics`
3. –î–æ–±–∞–≤–∏—Ç—å custom –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

## 6. –ü–†–û–ë–õ–ï–ú–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### 6.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–ª–æ—É
**–§–∞–π–ª:** `tests/`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –≤–∏–¥–Ω–æ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è:
- –ü–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
- Graceful shutdown –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- –†–∞–±–æ—Ç—ã –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis/RabbitMQ

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å testcontainers –¥–ª—è Postgres, Redis, RabbitMQ
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å failure scenarios

---

## 7. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 7.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API –≤ –∫–æ–¥–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –Ω–µ –∏–º–µ—é—Ç –ø–æ–¥—Ä–æ–±–Ω—ã—Ö docstring —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å OpenAPI descriptions:
```python
@router.post("/auth/login", response_model=TokenResponse, tags=["auth"])
async def login(
    payload: LoginRequest,
    session: AsyncSession = Depends(get_session)
):
    """
    –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
    
    - **email**: Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - **password**: –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    Returns:
        TokenResponse: JWT —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞
    
    Raises:
        401: –ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    """
```

---

### 7.2. Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è TTL –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**–§–∞–π–ª:** `src/edutrack/application/grades.py:7`
```python
GRADES_TTL = 60  # Hardcoded!
```
**–†–µ—à–µ–Ω–∏–µ:**
–í—ã–Ω–µ—Å—Ç–∏ –≤ settings.py –∫–∞–∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

---

## –ü–†–ò–û–†–ò–¢–ï–¢–´ –£–°–¢–†–ê–ù–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):
1. Hardcoded URL –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è (1.1)
2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª–µ–π (1.2)
3. –¢–æ–∫–µ–Ω—ã –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (1.4)
4. Singleton publisher —É—Ç–µ—á–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (3.1)
5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è mypy –∏ bandit (2.1, 2.2)

### üü° –í–´–°–û–ö–ò–ï (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):
1. Rate limiting –¥–ª—è auth —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (1.3)
2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (3.5)
3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ë–î (4.2)
4. –ü—Ä–æ–±–ª–µ–º–∞ —Å Redis pool (4.3)

### üü¢ –°–†–ï–î–ù–ò–ï (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å):
1. Race condition –≤ –∫–µ—à–µ (3.4)
2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å (3.3)
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ audit (5.1, 5.2)
4. –ú–µ—Ç—Ä–∏–∫–∏ (5.3)

### ‚ö™ –ù–ò–ó–ö–ò–ï (—Ç–µ—Ö–¥–æ–ª–≥):
1. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (7.1)
2. Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è (7.2)
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (6.1)

---

## –®–ê–ì–ò –î–õ–Ø –†–ï–®–ï–ù–ò–Ø –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ü–†–û–ë–õ–ï–ú

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (2.1, 2.2)
```bash
# –§–∞–π–ª: pyproject.toml
[tool.mypy]
exclude = [
    "venv/",
    ".venv/",
    "build/",
    "dist/",
    ".*\\.egg-info/",
]

# –§–∞–π–ª: bandit.yaml
exclude_dirs:
  - tests
  - venv
  - .venv
  - build
  - dist
  - "*.egg-info"
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–æ–ª–µ–π (1.2)
```python
# –§–∞–π–ª: src/edutrack/infrastructure/services/security.py
import re

def validate_password_strength(password: str) -> tuple[bool, str]:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è."""
    if len(password) < 8:
        return False, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤"
    if not re.search(r"[A-Z]", password):
        return False, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã"
    if not re.search(r"[a-z]", password):
        return False, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã"
    if not re.search(r"\d", password):
        return False, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—ã"
    if not re.search(r"[!@#$%^&*(),.?\":{}|<>]", password):
        return False, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã"
    return True, ""
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å FRONTEND_URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (1.1)
```python
# –§–∞–π–ª: src/edutrack/config/settings.py
class Settings(BaseSettings):
    # ... existing fields ...
    frontend_url: str = Field(
        default="http://localhost:3000",
        description="URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ email"
    )
```

### –®–∞–≥ 4: –•—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è (1.4)
```python
# –§–∞–π–ª: src/edutrack/infrastructure/services/security.py
import hashlib

def hash_token(token: str) -> str:
    """–•—ç—à–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è."""
    return hashlib.sha256(token.encode()).hexdigest()

# –§–∞–π–ª: src/edutrack/application/password_reset.py
async def request_reset(self, email: str) -> None:
    token = secrets.token_urlsafe(32)
    token_hash = hash_token(token)  # –•—ç—à–∏—Ä—É–µ–º –¥–ª—è –ë–î
    await self.tokens.create_token(user_id=user.id, token=token_hash, ...)
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π token –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    reset_url = f"{settings.frontend_url}/reset-password?token={token}"
```

### –®–∞–≥ 5: –ì–ª–æ–±–∞–ª—å–Ω—ã–π EmailPublisher singleton (3.1)
```python
# –§–∞–π–ª: src/edutrack/presentation/api/main.py
email_publisher: EmailPublisher | None = None

@asynccontextmanager
async def lifespan(app: FastAPI):
    global email_publisher
    # Startup
    email_publisher = EmailPublisher()
    logger.info("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ")
    yield
    # Shutdown
    if email_publisher:
        await email_publisher.close()
    await shutdown_handler()

# Dependency
async def get_email_publisher() -> EmailPublisher:
    return email_publisher

# –í routes/v1.py
async def send_message_email(
    ...,
    publisher: EmailPublisher = Depends(get_email_publisher),
):
    service = MessageService(session, publisher)
```

### –®–∞–≥ 6: –î–æ–±–∞–≤–∏—Ç—å rate limiting (1.3)
```bash
poetry add slowapi
```

```python
# –§–∞–π–ª: src/edutrack/presentation/api/main.py
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address
from slowapi.errors import RateLimitExceeded

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

# –í routes/v1.py
@router.post("/auth/login", ...)
@limiter.limit("5/15minute")
async def login(request: Request, payload: LoginRequest, ...):
    ...

@router.post("/auth/password-reset/request", ...)
@limiter.limit("3/hour")
async def request_password_reset(request: Request, payload: PasswordResetRequest, ...):
    ...
```

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ —Å–ª–µ–¥—É–µ—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –º–µ—Å—Ç, –Ω–æ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º.

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–¥–∞: 7/10**
- ‚úÖ –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ async/await
- ‚úÖ Graceful shutdown
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis
- ‚úÖ –û—á–µ—Ä–µ–¥–∏ —Å RabbitMQ
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting
- ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚ö†Ô∏è –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º: 2-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è**
**–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º: 1-2 –Ω–µ–¥–µ–ª–∏**
